import React, { useEffect, useState } from 'react';
import { useCookies } from 'react-cookie';
import { useNavigate } from 'react-router-dom';
import styles from './HeaderLogado.module.css';
import Logo from '../../assets/Logo.png';
import FiltroIcon from '../../assets/IconeFiltro.png';

const HeaderLogado = () => {
  const [cookies, , removeCookie] = useCookies(['userId']);
  const [usuario, setUsuario] = useState(null);
  const [menuAberto, setMenuAberto] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const navigate = useNavigate();

  useEffect(() => {
    const userId = cookies.userId;
    if (userId) {
      fetch(`http://localhost:3002/usuarios/${userId}`)
        .then(response => response.json())
        .then(data => {
          fetch(`http://localhost:3002/usuario_habilidades?usuarioId=${userId}`)
            .then(response => response.json())
            .then(habilidadesRelacionadas => {
              const habilidadesPromises = habilidadesRelacionadas.map(uh =>
                fetch(`http://localhost:3002/habilidades/${uh.habilidadeId}`)
                  .then(response => response.json())
              );
              Promise.all(habilidadesPromises).then(habilidades => {
                setUsuario({ ...data, habilidades });
              });
            });
        })
        .catch(error => console.error('Erro ao buscar dados do usuário:', error));
    }
  }, [cookies.userId]);

  const toggleMenu = () => {
    setMenuAberto(!menuAberto);
  };

  const handleLogout = () => {
    Object.keys(cookies).forEach((cookieName) => {
      removeCookie(cookieName, { path: '/' });
    });
    navigate('/login');
  };

  const handleCriarProjeto = () => {
    navigate('/criar-projeto');
  };

  const handleSearch = (e) => {
    e.preventDefault();
    if (searchQuery) {
      navigate(`/ResultadosPesquisa?q=${searchQuery}`); // Redireciona para o componente ResultadoPesquisa.jsx com a query
    }
  };

  const handleInputChange = (e) => {
    setSearchQuery(e.target.value);
  };

  if (!usuario) {
    return <div>Carregando...</div>;
  }

  return (
    <header className={styles.cabecalhoLogado}>
      <div className={styles.logoContainer}>
        <img src={Logo} alt="IndieStream Logo" className={styles.logo} />
      </div>
      <div className={styles.searchContainer}>
        <form onSubmit={handleSearch}>
          <input
            type="text"
            className={styles.searchInput}
            placeholder="Busque por pessoas ou projetos"
            value={searchQuery}
            onChange={handleInputChange}
          />
          <button type="submit" className={styles.filtroButton}>
            <img src={FiltroIcon} alt="Filtro" className={styles.filtroIcon} />
          </button>
        </form>
      </div>
      <button className={styles.criarProjetoButton} onClick={handleCriarProjeto}>
        Criar Projeto
      </button>
      <nav className={styles.navLinks}>
        <a href="/planos" className={styles.navLink}>Planos</a>
        <a href="/home" className={styles.navLink}>Home</a>
        <a href="/projetos" className={styles.navLink}>Projetos</a>
        <a href="/pessoas" className={styles.navLink}>Pessoas</a>
      </nav>
      <div className={styles.profileContainer}>
        <img
          src={usuario.imagem}
          alt={`Perfil de ${usuario.nome}`}
          className={styles.profileImage}
          onClick={toggleMenu}
        />
        {menuAberto && (
          <div className={styles.dropdownMenu}>
            <a href="/EditarUsuario" className={styles.dropdownItem}>Ver Perfil</a>
            <a href="/" className={`${styles.dropdownItem} ${styles.sairItem}`} onClick={handleLogout}>Sair</a>
          </div>
        )}
      </div>
    </header>
  );
};

export default HeaderLogado;

=============================================================================================================

import React, { useEffect, useState } from "react";
import CardPessoa from "../BoxUsuarios/BoxUsuarios";
import VisualizarUsuario from "../../Pages/VisualizaUsuario"; // Importar o componente
import styles from "./PessoasDestaque.module.css";

const PessoasEmDestaque = () => {
  const [usuarios, setUsuarios] = useState([]);
  const [usuarioSelecionado, setUsuarioSelecionado] = useState(null); // Estado para armazenar o usuário selecionado

  useEffect(() => {
    fetch("http://localhost:3002/usuarios") // Atualize a porta para 3002
      .then(response => response.json())
      .then(data => setUsuarios(data.slice(0, 4))) // Mostrando apenas 4 usuários
      .catch(error => console.error("Erro ao buscar dados:", error));
  }, []);

  const selecionarUsuario = (usuario) => {
    setUsuarioSelecionado(usuario); // Define o usuário clicado
  };

  return (
    <div className={styles.container}>
      <section className={styles.pessoasEmDestaque}>
        <h2>Pessoas em Destaque</h2>
        <div className={styles.gridPessoas}>
          {usuarios.map((usuario) => (
            <div onClick={() => selecionarUsuario(usuario)} key={usuario.id}>
              <CardPessoa usuario={usuario} />
            </div>
          ))}
        </div>
      </section>

      {usuarioSelecionado && (
        <VisualizarUsuario usuario={usuarioSelecionado} /> // Renderiza a página com o usuário selecionado
      )}
    </div>
  );
};

export default PessoasEmDestaque;

